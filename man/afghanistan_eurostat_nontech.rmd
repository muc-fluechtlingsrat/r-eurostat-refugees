---
title: "Asylentscheidungen in Europa"
author: "ynux"
date: "August, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

### Die Asyldaten von Eurostat
In diesem Artikel werfen wir einen Blick auf die Erstentscheidungen von den afghanischen Fü?chtlingen in Europa.

Eurostat ist das statistische Amt der Europäischen Union. Es sammelt und veröffentlicht Daten zu vielen Themen, auch zu Asyl und Migration.

Besonders interessant sind die Erstentscheidungsdaten. Das Datenset trägt den hübschen Namen `migr_asydcfsta`: "Erstinstanzliche Entscheidungen über Asylanträge nach Staatsangehörigkeit, Alter und Geschlecht Jährliche aggregierte Daten".

Für Deutschland sind das die Entscheidungen des Bundesamts für  Migration und Flüchtlinge (BAMF). Die Bezeichnung "erstinstanzlich" ist hier etwas verwirrend, denn die erste _juristische_ Instanz ist in Deutschland das Verwaltungsgericht, dass über Klagen gegen die Entscheidung des BAMF entscheidet.

Zurück zu unseren Daten. Sie decken die Jahre 2008 bis 2017 ab (Stand August 2018). Man kann sie von der Website von Eurostat herunterladen. Allerdings sind sie sind ziemlich groß - 85 Mb und 13 Millionen Werte. Mit Excel kommt man da nicht weiter, deswegen benutzt dieser Artikel die Statistiksprache `R`. 

Was bieten uns die Daten?

```{r get_data, echo=FALSE}
library(knitr)
library(dplyr)
migr_asydcfsta=readRDS(file="/tmp/migr_asydcfsta_20180812.rds")
# Ein Blick in die ersten Datensätze:
kable(filter(migr_asydcfsta, citizen == "AF")[c(1:18),], caption = "Ein paar Zeilen aus dem Datensatz, zum Herkunftsland Afhganistan")
# Die Struktur der Daten - hier sehen wir auch die Kategorien der Entscheidungen und der Altersklassen:
#str(migr_asydcfsta)
```

Wir konzentrieren uns im Folgenden auf:

* die Entscheidungen ("`deicision` und `values`")
* das Herkunftsland Afghanistan ("`citizen`") 
* das Jahr 2017
* die europäischen Länder ("`geo`"), für die es genug Daten gibt, 
um damit sinnvolle Analysen zu machen. Zur Abgrenzung von den Herkunftsländern heißen sie im Folgenden "Antragsland". 

```{r reduce_data_total}
cutoff=1000
major_geo_total=filter(migr_asydcfsta, values > cutoff, time == "2017-01-01", decision == "TOTAL", sex == "T", age == "TOTAL", citizen == "AF", geo != "EU28") %>% 
  select(geo,values) 
```

### Die Anzahl Entscheidungen pro Antragsland

Dies sind die europäischen Länder, in denen im Jahr 2017 mehr als 1000 Entscheidungen über Asylanträge von afghanischen Staatsangehörigen getroffen wurden:
    
```{r look_at_major_total,echo=FALSE}
library(knitr)
# Die ersten paar Spalten
kable(major_geo_total, caption = "Länder mit mehr als 1000 Entscheidungen zu Asylanträgen aus Afghanistan")
major_geo_total <- filter(major_geo_total, geo != "TOTAL")
```

Wenn Du an diesen Zahlen zweifelst und sie selber überprüfen willst, finde ich das genau richtig. Misstrauen in Daten ist gut. Eurostat hat einen Data Explorer unter eurostat -> Daten -> Datenbank -> Datenbank nach Themen -> Bevölkerung und soziale Bedingungen -> Asyl und Gesteuerte Migration, oder Du googelst nach "migr_asydcfsta".

Die Daten zeigen Ländercodes, die vollen Bezeichnungen sind hier:

```{r country_codes,  echo=FALSE}
geodic = read.delim(file = "/tmp/geo.dic", col.names = c("code","label"))
major_geo_total <- droplevels(major_geo_total)
geo_migr_asydcfsta_major = levels(major_geo_total$geo)
geodic_major <- filter(geodic,code %in% geo_migr_asydcfsta_major)
kable(geodic_major, caption = "Ländercodes der wichtigsten Antragsländer")

```

Diese Zahlen sind für mich schon überraschend. Die anderen 17 Länder sind zusammen für weniger als 600 Entscheidungen verantwortlich.

```{r other_geo_total,  echo=FALSE}
    other_geo_total=filter(migr_asydcfsta, values <= cutoff, time == "2017-01-01", decision == "TOTAL", sex == "T", age == "TOTAL", citizen == "AF", geo != "EU28", geo != "TOTAL") %>%  arrange(desc(values))
dec_others_total <- sum(other_geo_total$values)
dec_others_total
```

Eine Visualisierung der Gesamtanzahl von Entscheidungen zu Afghanistan im Jahr 2017:

```{r geo_decision_pie, echo = FALSE}
library(ggplot2)
# some technical workarounds for adding the row with the others (XX),
# and for sorting
major_geo_total$geo <- as.character(major_geo_total$geo)
all_geo_total <- rbind(major_geo_total, c("XX",dec_others_total))
all_geo_total$values <- as.numeric(all_geo_total$values) 
all_geo_total$geo <- factor(all_geo_total$geo, levels = arrange(all_geo_total, values)$geo)
# For the labels
big = 8
blables <- c(rev(levels(all_geo_total$geo))[c(1:big)],rep("",dim(all_geo_total)[1]-big))
y.breaks <- cumsum(all_geo_total$values) - all_geo_total$values/2
# The real thing
geo_dec_pie <- ggplot(all_geo_total, aes(x="", y=values, fill=geo)) + geom_col(colour = "black") + coord_polar("y", start=0) + scale_fill_grey(start = 0.4, end = 0.9) + ggtitle ("Entscheidungen über Asyl, Afghanistan, 2017", subtitle = "EU-Länder; XX ist die Summe aller Länder mit < 1000 Entscheidungen") + scale_y_continuous(labels=blables, breaks = y.breaks) + theme_bw() + theme(axis.title=element_blank()) 
geo_dec_pie
```

Überraschend finde ich außerdem, dass beispielsweise Spanien nicht in unserer Analyse vertreten ist, weil es nicht auf 1000 Entscheidungen kommt. Deutschland verantwortet fast 60% aller Entscheidungen. Nun ist Deutschland auch das bevölkerungsreichste Land der EU. Wenn wir uns die EU-Länder mit mehr als 8 Mio Einwohnern anschauen und neben ihre Einwohnerzahl (geteilt durch 1000) die Anzahl Entscheidungen stellen, erhalten wir dieses Bild:

```{r population_decisions, echo = FALSE}
demo_pjan <- readRDS(file="/tmp/demo_pjan_20180825.rds")
compare_dec=filter(migr_asydcfsta, time == "2017-01-01", decision == "TOTAL", sex == "T", age == "TOTAL", citizen == "AF", geo != "EU28", geo != "TOTAL") %>% select(geo, values) %>% mutate( stat = "dec")
compare_dec <- droplevels(compare_dec)
compare_pop <- demo_pjan %>% filter(age == "TOTAL" & sex == "T" & time == "2017-01-01" & geo %in% levels(compare_dec$geo)) %>% select(geo, values) %>% mutate( stat = "pop")
compare_pop <- droplevels(compare_pop)
# divide population by 1000, otherwise decisions won't be visible
compare_pop <- mutate(compare_pop, values = values / 1000)
compare_dec_pop <- rbind(compare_dec, compare_pop)

drop_countries_comp <- filter(compare_pop, values < 8000 & stat == "pop") %>% select(geo)
# population first, decisions second
compare_dec_pop$stat <- factor(compare_dec_pop$stat, levels=c("pop","dec"))
# sort by pop 
compare_dec_pop$geo <- factor(compare_dec_pop$geo, levels = arrange(filter(compare_dec_pop, stat == "pop"), desc(values))$geo)

bar_compare_dec_pop <- ggplot(filter(compare_dec_pop, !geo %in% unlist(drop_countries_comp)),  aes(x=geo, y=values, fill=stat)) + geom_bar(stat="identity", position="dodge") +  ggtitle("Vergleich von Bevölkerung in Tsd zu Asylentscheidungen", subtitle=" zu Afghanistan, 2017; EU Länder mit mehr als 8 Mio Einwohnern") + theme_bw() + theme(legend.position="bottom") + scale_fill_grey(start = 0.4, end = 0.7)

bar_compare_dec_pop 
```

In den großen Ländern außer Deutschland gab es auffallend wenig Entscheidungen. In den kleinen Ländern Schweden und Österreich dagegen überproportional viele. 

Bisher haben wir Vorbetrachtungen angestellt, um unsere Daten zu verstehen und zu überlegen, welche Antragsländer wir sinnvoll untersuchen können. Jetzt schauen wir uns die Entscheidungen an.

## Die Entscheidungen: GENCONV + HUMSTAT + SUB_PROT + TEMP_PROT + REJECTED = TOTAL_POS + REJECTED = TOTAL

Wie haben unsere 15 Länder entschieden? Was für Entscheidungstypen haben wir überhaupt?

```{r reduce_data, echo = FALSE}
major_geo <-filter(migr_asydcfsta, geo %in% major_geo_total$geo, time >= "2017-01-01", sex == "T", age == "TOTAL", citizen == "AF", geo != "EU28", geo != "TOTAL") %>% 
  select(geo,decision,values) 
major_geo$geo <- factor(major_geo$geo, levels = arrange(filter(major_geo, decision == "TOTAL"), desc(values))$geo)
# bring decisions into correct order
major_geo$decision <- factor(major_geo$decision, levels=c("REJECTED","TEMP_PROT","HUMSTAT","SUB_PROT","GENCONV","TOTAL_POS","TOTAL"))

```


```{r decision_dic, echo=FALSE}
decision.dic <- read.delim(file = "/tmp/decision.dic", col.names = c("code","label"))
kable(filter(decision.dic, code %in% levels(major_geo$decision)), caption = "Entscheidungscodes")
```

```{r decisions_abolut, echo = FALSE}
dec_palette_grey=c("#000000","#C0C0C0","#D3D3D3","#E4E4E4","#E8E8E8","#C8C8C8","#808080")

dec_bar <- ggplot(filter(major_geo, decision != "TOTAL" & decision != "TOTAL_POS")) + geom_col(aes(x=geo, y=values, fill=decision)) 
dec_bar +  scale_fill_manual(values = dec_palette_grey) + theme_bw() + theme(legend.position="bottom") + ggtitle("Entscheidungen über Asylanträge aus Afghanistan 2017", subtitle = "in absoluten Zahlen")
```

```{r fill_hist, echo=FALSE}
dec_bar_fill <- ggplot(filter(major_geo, decision != "TOTAL" & decision != "TOTAL_POS")) + geom_col(aes(x=geo, y=values, fill=decision), position="fill") + scale_fill_grey() + theme_bw() + theme(legend.position="bottom") + ggtitle("Entscheidungen über Asylanträge aus Afghanistan 2017", subtitle = "in Prozent")
dec_bar_fill
```

### Ab hier nur Notizen

Analysis: 

* DE takes care to keep POS below 50% (Bleibeperspektive)
* FR, CH, EL, IT clearly more positive 
* BG very negative - still 1388 decisions
 
Does this look like "it doesn't matter where in the EU you apply for asylum"?

Next questions:

* Is the picture (number and result of decisions) similar for SY? Eritrea? Pakistan? TOTAL? (should be simple)
* years 2015, 2016 (simple), 2018 (quarterly data)
* Deportations? We barely have numbers from DE ... probably no way (only Dublin numbers. bpb has sth on https://www.bpb.de/gesellschaft/migration/flucht/218788/zahlen-zu-asyl-in-deutschland)

Content to add:

* Bleibeperspektive
* Situation in Afghanistan (UNAMA - Zahlen, fragile state index)
* Abschiebungen
* Warum verschiedene Quoten in der EU ein Problem sind, Dublin
* Verwaltungsgerichtsentscheide 
* Some remarks on refugee datathon muc

Code ist hier: https://github.com/muc-fluechtlingsrat/r-eurostat-refugees/blob/master/man/afghanistan_eurostat_nontech.rmd